<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Изрязване на контурни отсечки (Cohen-Sutherland)</title>
  <style>
    canvas { border: 1px solid black; }
  </style>
</head>
<body>
<h3>Прозорец за визуализация с рязане на отсечки</h3>
<canvas id="canvas" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// Параметри на прозореца (в координати на canvas)
const Xmin = 100, Ymin = 100, Xmax = 500, Ymax = 300;

// Примерни контурни отсечки
const segments = [
  {x1: 50, y1: 50, x2: 550, y2: 350},    // пресича целия прозорец
  {x1: 150, y1: 150, x2: 200, y2: 250},  // напълно вътре
  {x1: 550, y1: 200, x2: 600, y2: 200},  // напълно извън
  {x1: 50, y1: 250, x2: 150, y2: 350},   // частично вътре
  {x1: 300, y1: 50, x2: 300, y2: 350},   // пресича отгоре до долу
];

// Рисува прозореца
function drawWindow() {
  ctx.strokeStyle = "blue";
  ctx.strokeRect(Xmin, Ymin, Xmax - Xmin, Ymax - Ymin);
}

// Главна функция
function clipAndDraw() {
  drawWindow();

  for (const seg of segments) {
    const clipped = cohenSutherland(seg.x1, seg.y1, seg.x2, seg.y2);
    if (clipped) {
      const [x1, y1, x2, y2] = clipped;
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = "black";
      ctx.stroke();
    }
  }
}

// Функция за намиране на 4-битовия код
function computeCode(x, y) {
  let code = 0;
  if (y > Ymax) code |= 1 << 0; // 1-ви бит: над
  if (y < Ymin) code |= 1 << 1; // 2-ри бит: под
  if (x > Xmax) code |= 1 << 2; // 3-ти бит: вдясно
  if (x < Xmin) code |= 1 << 3; // 4-ти бит: вляво
  return code;
}

// Алгоритъм на Коен-Съдърланд
function cohenSutherland(x1, y1, x2, y2) {
  let code1 = computeCode(x1, y1);
  let code2 = computeCode(x2, y2);

  let accept = false;

  while (true) {
    if ((code1 | code2) === 0) {
      // и двете точки вътре
      accept = true;
      break;
    } else if ((code1 & code2) !== 0) {
      // напълно извън – споделят външна зона
      break;
    } else {
      // частично – поне една точка извън
      let x, y;
      let codeOut = code1 ? code1 : code2;

      if (codeOut & (1 << 0)) { // над
        x = x1 + (x2 - x1) * (Ymax - y1) / (y2 - y1);
        y = Ymax;
      } else if (codeOut & (1 << 1)) { // под
        x = x1 + (x2 - x1) * (Ymin - y1) / (y2 - y1);
        y = Ymin;
      } else if (codeOut & (1 << 2)) { // вдясно
        y = y1 + (y2 - y1) * (Xmax - x1) / (x2 - x1);
        x = Xmax;
      } else if (codeOut & (1 << 3)) { // вляво
        y = y1 + (y2 - y1) * (Xmin - x1) / (x2 - x1);
        x = Xmin;
      }

      // Заменяме извън точката със сечна точка
      if (codeOut === code1) {
        x1 = x;
        y1 = y;
        code1 = computeCode(x1, y1);
      } else {
        x2 = x;
        y2 = y;
        code2 = computeCode(x2, y2);
      }
    }
  }

  if (accept) return [x1, y1, x2, y2];
  return null;
}

clipAndDraw();
</script>

</body>
</html>

